# ğŸ” VPS Stock Monitor ä»£ç å®¡è®¡æŠ¥å‘Š

**å®¡è®¡æ—¥æœŸ**: 2026-01-18  
**é¡¹ç›®ç‰ˆæœ¬**: 1.0.0  
**ä»£ç è¡Œæ•°**: ~7,400 è¡Œ Python ä»£ç   
**å®¡è®¡èŒƒå›´**: å…¨éƒ¨æºä»£ç ã€é…ç½®æ–‡ä»¶ã€Docker éƒ¨ç½²æ–‡ä»¶

---

## ğŸ“Š å®¡è®¡æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é—®é¢˜ç»Ÿè®¡æ±‡æ€»                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸¥é‡ç¨‹åº¦     â”‚ æ•°é‡    â”‚ è¯´æ˜                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ Critical â”‚   8     â”‚ ä¸¥é‡å®‰å…¨æ¼æ´ï¼Œéœ€ç«‹å³ä¿®å¤                  â”‚
â”‚ ğŸŸ  High     â”‚  27     â”‚ ç¨³å®šæ€§/å®‰å…¨é—®é¢˜ï¼Œéœ€å°½å¿«ä¿®å¤               â”‚
â”‚ ğŸŸ¡ Medium   â”‚  45     â”‚ å¥å£®æ€§é—®é¢˜ï¼Œè®¡åˆ’ä¿®å¤                      â”‚
â”‚ ğŸŸ¢ Low      â”‚  40     â”‚ ä»£ç è´¨é‡æ”¹è¿›å»ºè®®                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ€»è®¡        â”‚  120    â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ Critical é—®é¢˜ (8ä¸ª)

### 1. API è®¤è¯é»˜è®¤ç¦ç”¨
- **ä½ç½®**: `config.yaml.example` è¡Œ 201-203
- **æè¿°**: API è®¤è¯ `auth.enabled: false`ï¼Œé»˜è®¤å®Œå…¨å¼€æ”¾ç®¡ç†æ¥å£
- **å½±å“**: ä»»ä½•äººå¯è®¿é—®/ä¿®æ”¹ç›‘æ§é…ç½®
- **ä¿®å¤**: é»˜è®¤å¯ç”¨è®¤è¯ï¼Œç©º API Key æ—¶æ‹’ç»å¯åŠ¨

### 2. SSRF æ¼æ´ - äº§å“ URL æœªéªŒè¯
- **ä½ç½®**: `src/api/routes/products.py` è¡Œ 176-191
- **æè¿°**: åˆ›å»ºäº§å“æ—¶æ¥å—ä»»æ„ URLï¼Œå¯æŒ‡å‘å†…ç½‘æœåŠ¡
- **å½±å“**: å¯è®¿é—® `localhost`ã€`169.254.169.254` ç­‰å†…éƒ¨åœ°å€
- **ä¿®å¤**: 
```python
BLOCKED_HOSTS = {'localhost', '127.0.0.1', '169.254.169.254'}
if parsed.hostname in BLOCKED_HOSTS:
    raise HTTPException(400, "Internal URLs not allowed")
```

### 3. product_id æ³¨å…¥é£é™©
- **ä½ç½®**: `src/api/routes/products.py` å¤šå¤„
- **æè¿°**: è·¯å¾„å‚æ•° `product_id` ç›´æ¥ç”¨äº Redis Keyï¼ŒæœªéªŒè¯æ ¼å¼
- **å½±å“**: å¯èƒ½æ³¨å…¥ç‰¹æ®Šå­—ç¬¦å½±å“ Redis æ“ä½œ
- **ä¿®å¤**: æ·»åŠ æ­£åˆ™éªŒè¯ `^[a-f0-9]{16}$`

### 4. Redis KEYS å‘½ä»¤ä½¿ç”¨
- **ä½ç½®**: `src/api/routes/system.py` è¡Œ 122-126
- **æè¿°**: ä½¿ç”¨ `redis.keys()` å¯èƒ½é˜»å¡ Redis
- **å½±å“**: ç”Ÿäº§ç¯å¢ƒæ€§èƒ½é—®é¢˜
- **ä¿®å¤**: ä½¿ç”¨ `SCAN` å‘½ä»¤æ›¿ä»£

### 5. æ•æ„Ÿä¿¡æ¯æ—¥å¿—æ³„éœ²é£é™©
- **ä½ç½®**: `src/config/settings.py` è¡Œ 31-51
- **æè¿°**: `bot_token`ã€`smtp_password` ç­‰å­—æ®µé»˜è®¤ `__repr__` ä¼šæ‰“å°
- **å½±å“**: æ—¥å¿—ä¸­å¯èƒ½æš´éœ²å‡­æ®
- **ä¿®å¤**: ä½¿ç”¨ `field(repr=False)` æˆ–è‡ªå®šä¹‰ `__repr__`

### 6. é…ç½®æ–‡ä»¶è·¯å¾„éå†
- **ä½ç½®**: `src/config/settings.py` è¡Œ 178-200
- **æè¿°**: `config_file` å‚æ•°æœªéªŒè¯ï¼Œå¯æ¥å— `../../etc/passwd`
- **å½±å“**: å¯èƒ½è¯»å–æ•æ„Ÿç³»ç»Ÿæ–‡ä»¶
- **ä¿®å¤**: éªŒè¯è·¯å¾„åœ¨å…è®¸ç›®å½•å†…

### 7. Telegram Token URL æš´éœ²
- **ä½ç½®**: `src/notifications/telegram.py` è¡Œ 46
- **æè¿°**: Token åµŒå…¥åˆ° `base_url` å…¬å…±å±æ€§
- **å½±å“**: å¯¹è±¡åºåˆ—åŒ–/è°ƒè¯•æ—¶æ³„éœ² Token
- **ä¿®å¤**: åŠ¨æ€ç”Ÿæˆ API URLï¼Œä¸å­˜å‚¨å®Œæ•´ URL

### 8. å‘½ä»¤æ³¨å…¥é£é™©
- **ä½ç½®**: `src/api/routes/system.py` è¡Œ 37-51
- **æè¿°**: ç›´æ¥å‘å¸ƒå‘½ä»¤å­—ç¬¦ä¸²åˆ° Redisï¼ŒæœªéªŒè¯
- **å½±å“**: å‘½ä»¤å¤„ç†ç«¯å¯èƒ½è¢«æ³¨å…¥
- **ä¿®å¤**: ä½¿ç”¨æšä¸¾éªŒè¯å‘½ä»¤

---

## ğŸŸ  High é—®é¢˜ (27ä¸ª)

### API æ¨¡å—
1. **çŠ¶æ€è·¯ç”±ç¼ºå°‘è®¤è¯** - `app.py` è¡Œ 113-117
2. **trigger_check ç¼ºå°‘é€Ÿç‡é™åˆ¶** - `products.py` è¡Œ 264-277
3. **sync_products æ•°æ®è¦†ç›–é£é™©** - `products.py` è¡Œ 295-329
4. **Redis æ“ä½œç¼ºå°‘å®Œæ•´å¼‚å¸¸å¤„ç†** - å¤šå¤„
5. **reset-stats æ— è®¤è¯ä¿æŠ¤** - `status.py` è¡Œ 152-161

### é…ç½®æ¨¡å—
6. **çƒ­é‡è½½ç«æ€æ¡ä»¶** - `settings.py` è¡Œ 203-217
7. **å•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨** - `settings.py` è¡Œ 165-174
8. **é…ç½®åŠ è½½å¤±è´¥è¡Œä¸ºä¸å¯é¢„æµ‹** - `settings.py` è¡Œ 188-200
9. **å…¨å±€ PRODUCTS åˆ—è¡¨å¹¶å‘ä¸å®‰å…¨** - `products.py` è¡Œ 72

### é€šçŸ¥æ¨¡å—
10. **Discord Webhook URL æœªéªŒè¯** - `discord.py` è¡Œ 41-55
11. **é‚®ä»¶åœ°å€æœªéªŒè¯** - `email.py` è¡Œ 54-62
12. **é‚®ä»¶å¤´æ³¨å…¥é£é™©** - `email.py` è¡Œ 183
13. **Telegram chat_id æœªéªŒè¯** - `telegram.py` è¡Œ 40

### å·¥å…·æ¨¡å—
14. **Redis è¿æ¥ç®¡ç†é—®é¢˜** - `redis_service.py`
15. **æ··åˆåŒæ­¥/å¼‚æ­¥é”ä½¿ç”¨** - `deps.py` è¡Œ 55-66

### éƒ¨ç½²é…ç½®
16. **Redis é»˜è®¤æ— å¯†ç ** - `config.yaml.example`
17. **å®¹å™¨ä»¥ root è¿è¡Œ** - `Dockerfile`
18. **ä¾èµ–ç‰ˆæœ¬æœªé”å®š** - `requirements.txt`
19. **docker-compose ç¼ºå°‘ Redis æœåŠ¡** - `docker-compose.yml`
20. **CORS é…ç½®è¿‡äºå®½æ¾** - `config.yaml.example`

### éªŒè¯ç æ¨¡å—
21. **API Key å¯èƒ½åœ¨å¼‚å¸¸ä¸­æ³„éœ²** - `capmonster.py` è¡Œ 106-108
22. **é‡å¤å¯¼å…¥ asyncio** - `solver.py`

### æ ¸å¿ƒæ¨¡å—
23-27. æµè§ˆå™¨ç®¡ç†ã€è°ƒåº¦å™¨ã€ç›‘æ§å™¨ä¸­çš„èµ„æºç®¡ç†å’Œå¼‚å¸¸å¤„ç†é—®é¢˜

---

## ğŸŸ¡ Medium é—®é¢˜ (45ä¸ª)

### ç±»å‹éªŒè¯ä¸æ•°æ®å¤„ç†
- URL å­—æ®µç¼ºå°‘æ ¼å¼éªŒè¯ (schemas.py)
- å­—ç¬¦ä¸²å­—æ®µç¼ºå°‘é•¿åº¦é™åˆ¶ (schemas.py)
- datetime è§£ææœªå¤„ç†å¼‚å¸¸ (status.py)
- ä»·æ ¼è½¬æ¢æœªå¤„ç†å¼‚å¸¸ (products.py)
- int() è½¬æ¢æœªå¤„ç†å¼‚å¸¸ (status.py)

### å¹¶å‘ä¸èµ„æºç®¡ç†
- å…¨å±€å˜é‡éçº¿ç¨‹å®‰å…¨ (app.py)
- é™æ€æ–‡ä»¶è·¯å¾„ç¡¬ç¼–ç  (app.py)
- Redis è¿æ¥æ± æœªè®¾ç½®é™åˆ¶ (deps.py)
- get_redis() ä¸æ£€æŸ¥è¿æ¥æœ‰æ•ˆæ€§ (deps.py)
- aiohttp.ClientSession èµ„æºæ³„éœ²é£é™© (discord.py, telegram.py)

### é…ç½®ä¸éªŒè¯
- parse_mode æœªéªŒè¯ (telegram.py)
- Telegram æ¶ˆæ¯é•¿åº¦æœªé™åˆ¶ (telegram.py)
- avatar_url æœªéªŒè¯ (discord.py)
- SSL ä¸Šä¸‹æ–‡æœªé…ç½®éªŒè¯ (email.py)
- æ—¥å¿—çº§åˆ«éªŒè¯ç¼ºå¤± (settings.py)

### å®‰å…¨ç›¸å…³
- Markdown è½¬ä¹‰å¯èƒ½ä¸å®Œæ•´ (base.py)
- URL åœ¨ Markdown ä¸­æœªå®Œå…¨éªŒè¯ (base.py)
- get_current_config å¯èƒ½æ³„éœ²ä¿¡æ¯ (system.py)
- JSON è§£æå¼‚å¸¸è¢«é™é»˜å¿½ç•¥ (websocket.py)
- Redis è®¢é˜…å™¨æ²¡æœ‰é‡è¿æœºåˆ¶ (websocket.py)

### N+1 æŸ¥è¯¢é—®é¢˜
- list_products æŸ¥è¯¢éƒ¨åˆ†è§£å†³ (products.py)
- get_stats N+1 æŸ¥è¯¢ (status.py)

### Docker/éƒ¨ç½²
- é…ç½®æ–‡ä»¶æŒ‚è½½ä½¿ç”¨é”™è¯¯æ–‡ä»¶å (docker-compose.yml)
- ç¯å¢ƒå˜é‡ä¸ YAML é…ç½®ä¸ä¸€è‡´ (docker-compose.yml)
- å¥åº·æ£€æŸ¥è¿‡äºç®€å• (Dockerfile)
- æœªå›ºå®šåŸºç¡€é•œåƒå“ˆå¸Œ (Dockerfile)
- å¼€å‘ä¾èµ–ä¸ç”Ÿäº§ä¾èµ–æ··åˆ (requirements.txt)

### å…¶ä»–
- Windows ä¿¡å·å¤„ç†é™çº§æ— å‘Šè­¦ (main.py)
- API æœåŠ¡å™¨é»˜è®¤ç»‘å®š 0.0.0.0 (main.py)
- å…±äº«çº¿ç¨‹æ± å¯èƒ½é˜»å¡ (email.py)
- SMTP è¿æ¥æœªå¤ç”¨ (email.py)
- task_id ç±»å‹ç¼ºä¹éªŒè¯ (capmonster.py)
- éªŒè¯ç æ£€æµ‹å¯èƒ½è¯¯æŠ¥ (solver.py)

---

## ğŸŸ¢ Low é—®é¢˜ (40ä¸ª)

### ä»£ç è´¨é‡
- é…ç½®è§‚å¯Ÿå™¨è®¿é—®ç§æœ‰å±æ€§ (app.py)
- API Key éªŒè¯å‡½æ•°è¿”å›ç±»å‹ä¸ä¸€è‡´ (app.py)
- æ—¥å¿—æš´éœ²è¿æ¥ä¿¡æ¯ (deps.py)
- JSON å¯¼å…¥ä½ç½®ä¸ä¸€è‡´ (products.py)
- ç‰ˆæœ¬å·ç¡¬ç¼–ç  (status.py, system.py)
- ç¡¬ç¼–ç çš„é‡è¯•é…ç½® (discord.py, capmonster.py)
- ä»£ç é‡å¤ (email.py)
- ä½¿ç”¨å·²å¼ƒç”¨ API asyncio.get_event_loop() (email.py)
- ç¼ºå°‘ NotificationManager å¯¼å‡º (__init__.py)
- æœªä½¿ç”¨çš„å¯¼å…¥ (products.py)
- ç¡¬ç¼–ç é»˜è®¤å€¼åˆ†æ•£ (settings.py)
- site_configs æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡ (settings.py)

### å¥å£®æ€§æ”¹è¿›
- health_check ä¸å¤Ÿå…¨é¢ (system.py)
- å¿ƒè·³è¶…æ—¶é…ç½®å¯æ”¹è¿› (websocket.py)
- ç¼ºå°‘ API Key æ ¼å¼éªŒè¯ (capmonster.py)
- ç¼ºå°‘å–æ¶ˆä»»åŠ¡æ–¹æ³• (capmonster.py)
- å¼‚å¸¸ç±»å±‚æ¬¡ç»“æ„å¯æ‰©å±• (capmonster.py)
- solve æ–¹æ³•ç¼ºå°‘è¿”å›ç±»å‹æç¤º (solver.py)
- Cloudflare Challenge æ£€æµ‹æŒ‡æ ‡è¿‡äºå®½æ³› (solver.py)
- ç¼ºå°‘éªŒè¯ç ç±»å‹æšä¸¾ (solver.py)
- sitekey æœªéªŒè¯æ ¼å¼ (solver.py)

### éƒ¨ç½²é…ç½®
- ä½¿ç”¨å·²åºŸå¼ƒ version å­—æ®µ (docker-compose.yml)
- ç¼ºå°‘å®‰å…¨æ€§å¼ºåŒ–é…ç½® (docker-compose.yml)
- ç¼ºå°‘ .dockerignore å¼•ç”¨è¯´æ˜ (Dockerfile)
- ç¼ºå°‘å®‰å…¨ä¾èµ–å®¡è®¡ (requirements.txt)
- run_once å‡½æ•°ç¼ºå°‘å¼‚å¸¸å¤„ç† (main.py)
- ç¼ºå°‘ --version å‘½ä»¤è¡Œå‚æ•° (main.py)
- æœªéªŒè¯é…ç½®æ–‡ä»¶å­˜åœ¨ (main.py)

---

## ğŸ“‹ ä¿®å¤ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ ç«‹å³ä¿®å¤ (P0 - 24å°æ—¶å†…)
1. API è®¤è¯é»˜è®¤ç¦ç”¨
2. SSRF æ¼æ´
3. Telegram Token æš´éœ²
4. æ•æ„Ÿä¿¡æ¯æ—¥å¿—æ³„éœ²

### ğŸŸ  å°½å¿«ä¿®å¤ (P1 - 1å‘¨å†…)
1. product_id æ³¨å…¥éªŒè¯
2. Redis KEYS æ›¿æ¢ä¸º SCAN
3. Webhook/é‚®ä»¶åœ°å€éªŒè¯
4. é€Ÿç‡é™åˆ¶
5. å®¹å™¨é root è¿è¡Œ
6. ä¾èµ–ç‰ˆæœ¬é”å®š

### ğŸŸ¡ è®¡åˆ’ä¿®å¤ (P2 - 2å‘¨å†…)
1. ç±»å‹éªŒè¯å®Œå–„
2. èµ„æºç®¡ç†æ”¹è¿›
3. N+1 æŸ¥è¯¢ä¼˜åŒ–
4. é…ç½®ä¸€è‡´æ€§

### ğŸŸ¢ ä¼˜åŒ–æ”¹è¿› (P3 - è¿­ä»£ä¸­)
1. ä»£ç é‡æ„
2. æ€§èƒ½ä¼˜åŒ–
3. æ–‡æ¡£å®Œå–„

---

## âœ… é¡¹ç›®ä¼˜ç‚¹

1. **ä»£ç ç»“æ„æ¸…æ™°** - æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»è‰¯å¥½
2. **ç°ä»£ Python ç‰¹æ€§** - ä½¿ç”¨ dataclassã€Enumã€typing
3. **å®Œæ•´çš„é‡è¯•æœºåˆ¶** - ç½‘ç»œè¯·æ±‚æœ‰å®Œå–„çš„é‡è¯•å’Œè¶…æ—¶å¤„ç†
4. **å®‰å…¨æ„è¯†** - å·²æœ‰æ—¶åºå®‰å…¨æ¯”è¾ƒã€HTML è½¬ä¹‰ç­‰
5. **ä¸Šä¸‹æ–‡ç®¡ç†å™¨** - èµ„æºç®¡ç†ä½¿ç”¨ async with æ¨¡å¼
6. **é…ç½®çƒ­é‡è½½** - æ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°
7. **å¤šé€šçŸ¥æ¸ é“** - Telegram/Discord/Email å®Œæ•´æ”¯æŒ
8. **éªŒè¯ç è§£å†³æ–¹æ¡ˆ** - å®Œæ•´çš„ CapMonster é›†æˆ

---

## ğŸ“ˆ ä¸ä¸Šæ¬¡å®¡è®¡å¯¹æ¯”

| æŒ‡æ ‡ | ä¸Šæ¬¡ (v0.9) | æœ¬æ¬¡ (v1.0) | å˜åŒ– |
|------|------------|------------|------|
| Critical | 21 | 8 | â¬‡ï¸ -62% |
| High | 29 | 27 | â¬‡ï¸ -7% |
| Medium | 33 | 45 | â¬†ï¸ +36%* |
| Low | 31 | 40 | â¬†ï¸ +29%* |
| æ€»è®¡ | 114 | 120 | â¬†ï¸ +5%* |

> *æ³¨: Medium/Low é—®é¢˜å¢åŠ æ˜¯ç”±äºæœ¬æ¬¡å®¡è®¡æ›´åŠ æ·±å…¥ç»†è‡´ï¼Œè¦†ç›–äº†æ›´å¤šä»£ç è´¨é‡å’Œå¥å£®æ€§æ”¹è¿›å»ºè®®ã€‚

---

## ğŸ”§ è‡ªåŠ¨åŒ–å»ºè®®

å»ºè®®åœ¨ CI/CD ä¸­é›†æˆä»¥ä¸‹æ£€æŸ¥ï¼š

```yaml
# .github/workflows/security.yml
- name: Dependency Audit
  run: pip-audit -r requirements.txt

- name: SAST Scan
  uses: github/codeql-action/analyze@v2

- name: Secret Scan
  uses: trufflesecurity/trufflehog@main
```

---

**å®¡è®¡äºº**: Alma AI  
**å®¡è®¡æ—¶é—´**: 2026-01-18 04:13 UTC+8
